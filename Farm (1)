task.wait(5)

-- === CONFIGURATION & WEBHOOK ===
getgenv().AutoRadioactive = true
local webhook_url = "https://discord.com/api/webhooks/1433619088588017684/02wMrYk7vdbmgEz46dCdDiJrj9QONW7SKqAibBQdwO__JaFuRycX_6L-nmLSpJd_-Xb9" 
local targetBrainrot = "Galactio Fantasma"
local targetLevel = 125
local targetMutation = "Admin"
local waitTime = 45.5 * 60 

-- Services
local player = game.Players.LocalPlayer
local RS = game:GetService("ReplicatedStorage")
local coreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

local spawnRemote = RS:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RF/SpawnMachine.Action") 
local machinePath = workspace:WaitForChild("SpawnMachines"):WaitForChild("Default") 
local targetPosSpawn = Vector3.new(138, 3, 78) 

-- === FUNCTIONS ===
local function sendWebhook(oldC, newC)
    -- Mendapatkan username dan menyembunyikannya dengan spoiler ||username||
    local hiddenUsername = "||" .. player.Name .. "||"
    
    local data = {
        ["content"] = "üöÄ **DUPE SUCCESS!**",
        ["embeds"] = {{
            ["title"] = "Auto Dupe Detection", 
            ["color"] = 65280,
            ["fields"] = {
                {["name"] = "Player", ["value"] = hiddenUsername, ["inline"] = false}, -- Menambahkan Username (Hidden)
                {["name"] = "Item", ["value"] = targetBrainrot .. " (Lvl " .. targetLevel .. ")", ["inline"] = false},
                {["name"] = "Mutation", ["value"] = targetMutation, ["inline"] = true},
                {["name"] = "Inventory Sebelum", ["value"] = tostring(oldC), ["inline"] = true},
                {["name"] = "Inventory Sesudah", ["value"] = tostring(newC), ["inline"] = true},
                {["name"] = "Keuntungan", ["value"] = "+" .. tostring(newC - oldC), ["inline"] = true} 
            },
            ["footer"] = {["text"] = "Brainrot Manager ‚Ä¢ " .. os.date("%X")}
        }}
    }
    local request = syn and syn.request or http_request or request or HttpPost
    if request then
        request({Url = webhook_url, Method = "POST", Headers = {["Content-Type"] = "application/json"}, Body = HttpService:JSONEncode(data)}) 
    end
end

local function unequipAll()
    local char = player.Character
    if char then
        local hum = char:FindFirstChildOfClass("Humanoid")
        if hum then 
            hum:UnequipTools() 
            print("Safety Unequip: Semua item dilepas ke backpack.")
        end
    end
end

local function setFreeze(status)
    local char = player.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.Anchored = status 
    end
end

local function countTargetInventory()
    local total = 0
    local locations = {player.Backpack:GetChildren(), (player.Character and player.Character:GetChildren() or {})} 
    for _, list in pairs(locations) do
        for _, item in pairs(list) do
            if item:IsA("Tool") then
                local bName = item:GetAttribute("BrainrotName") or item.Name 
                if bName == targetBrainrot and item:GetAttribute("Level") == targetLevel and item:GetAttribute("Mutation") == targetMutation then
                    total = total + 1 
                end
            end
        end
    end
    return total
end

-- === UI SETUP ===
if coreGui:FindFirstChild("RadioactiveTimerUI") then coreGui:FindFirstChild("RadioactiveTimerUI"):Destroy() end
local sg = Instance.new("ScreenGui", coreGui); sg.Name = "RadioactiveTimerUI" 
local MainFrame = Instance.new("Frame", sg)
MainFrame.Size = UDim2.new(0, 220, 0, 150); MainFrame.Position = UDim2.new(0.8, 0, 0.5, 0) 
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30); MainFrame.Active = true; MainFrame.Draggable = true 
Instance.new("UICorner", MainFrame)

local StatusLabel = Instance.new("TextLabel", MainFrame)
StatusLabel.Size = UDim2.new(1, 0, 0, 40); StatusLabel.Position = UDim2.new(0, 0, 0.2, 0) 
StatusLabel.TextColor3 = Color3.fromRGB(0, 170, 255); StatusLabel.BackgroundTransparency = 1; StatusLabel.Font = Enum.Font.Gotham 

local ToggleBtn = Instance.new("TextButton", MainFrame)
ToggleBtn.Size = UDim2.new(0.8, 0, 0, 30); ToggleBtn.Position = UDim2.new(0.1, 0, 0.6, 0) 
ToggleBtn.Text = "AUTO DUPE: ON"; ToggleBtn.BackgroundColor3 = Color3.fromRGB(46, 204, 113) 
Instance.new("UICorner", ToggleBtn)

ToggleBtn.MouseButton1Click:Connect(function()
    getgenv().AutoRadioactive = not getgenv().AutoRadioactive
    ToggleBtn.Text = getgenv().AutoRadioactive and "AUTO DUPE: ON" or "AUTO DUPE: OFF"
    ToggleBtn.BackgroundColor3 = getgenv().AutoRadioactive and Color3.fromRGB(46, 204, 113) or Color3.fromRGB(192, 57, 43)
end)

-- === MAIN LOOP ===
task.spawn(function()
    while true do
        if getgenv().AutoRadioactive then
            local timeLeft = waitTime
            local unequipTriggered = false -- Reset trigger tiap siklus baru
            
            while timeLeft > 0 and getgenv().AutoRadioactive do
                StatusLabel.Text = "Next Dupe: " .. math.floor(timeLeft/60) .. "m " .. (timeLeft%60) .. "s"
                
                -- Fitur 30 Detik Sebelum Selesai
                if timeLeft <= 30 and not unequipTriggered then
                    unequipAll()
                    unequipTriggered = true -- Memastikan hanya terpanggil sekali
                end
                
                task.wait(1)
                timeLeft = timeLeft - 1
            end

            if getgenv().AutoRadioactive then
                local char = player.Character
                local root = char and char:FindFirstChild("HumanoidRootPart")
                local hum = char and char:FindFirstChildOfClass("Humanoid")
                
                if root and hum then
                    StatusLabel.Text = "Teleporting..." 
                    root.CFrame = CFrame.new(targetPosSpawn) 
                    task.wait(0.5)
                    setFreeze(true)

                    StatusLabel.Text = "Cleaning Machine..."
                    spawnRemote:InvokeServer("Withdraw", machinePath)
                    task.wait(1)

                    local countBefore = countTargetInventory()

                    local unit = nil
                    for _, v in pairs(player.Backpack:GetChildren()) do
                        if v:GetAttribute("BrainrotName") == targetBrainrot and v:GetAttribute("Level") == targetLevel and v:GetAttribute("Mutation") == targetMutation then
                            unit = v break 
                        end
                    end

                    if unit then
                        StatusLabel.Text = "Holding Item..." 
                        hum:EquipTool(unit) 
                        task.wait(2) 

                        StatusLabel.Text = "Depositing..." 
                        spawnRemote:InvokeServer("Deposit", machinePath) 
                        task.wait(2) 

                        StatusLabel.Text = "Combining..." 
                        spawnRemote:InvokeServer("Combine", machinePath) 
                        
                        for i = 5, 1, -1 do
                            StatusLabel.Text = "Detecting in " .. i .. "s..." 
                            task.wait(1) 
                        end
                        
                        local countAfter = countTargetInventory()
                        if countAfter > countBefore then
                            StatusLabel.Text = "‚úÖ SUCCESS!" 
                            sendWebhook(countBefore, countAfter) -- Webhook diaktifkan kembali
                        else
                            StatusLabel.Text = "‚ùå Failed (No Gain)" 
                        end
                    else
                        StatusLabel.Text = "‚ö†Ô∏è Item Not Found!" 
                    end
                    setFreeze(false)
                    task.wait(5)
                end
            end
        else
            StatusLabel.Text = "System Paused"; task.wait(1) 
        end
    end
end)
