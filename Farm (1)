task.wait(5)
local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local player = Players.LocalPlayer

-- // CONFIGURATION // --
getgenv().AutoRadioactive = true
local waitTime = 30 * 60
local skipWait = false
local targetPosSpawn = Vector3.new(138, 3, 137)

local webhook_dupe = "https://discord.com/api/webhooks/1433619088588017684/02wMrYk7vdbmgEz46dCdDiJrj9QONW7SKqAibBQdwO__JaFuRycX_6L-nmLSpJd_-Xb9"
local webhook_inventory = "https://discord.com/api/webhooks/1466083152073195530/NvOMzqOKfzUKn-rNw-4mx6dDxVwe0gPLfMJMut1QSRFTVI5OK5x-APBf72tJMCNZWvYQ"

local targetNames = {"Bulbito", "Traktorito", "Burgerini"}
local commonNames = {"Noobini", "Lirili", "Cheese", "Frulli", "Talpa", "Svinino", "Kiwi", "Corni"}

local spawnRemote = RS:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RF/SpawnMachine.Action")
local machinePath = workspace:WaitForChild("SpawnMachines"):WaitForChild("Default")

-- // UI STATUS // --
local UI_Status
local function createUI()
    local sg = Instance.new("ScreenGui", game:GetService("CoreGui"))
    sg.Name = "DupePremiumUI"
    
    local f = Instance.new("Frame", sg)
    f.Size = UDim2.new(0, 220, 0, 100)
    f.Position = UDim2.new(0.8, 0, 0.2, 0)
    f.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    f.Active = true
    f.Draggable = true
    Instance.new("UICorner", f)
    
    UI_Status = Instance.new("TextLabel", f)
    UI_Status.Size = UDim2.new(1, 0, 1, 0)
    UI_Status.BackgroundTransparency = 1
    UI_Status.TextColor3 = Color3.new(1, 1, 1)
    UI_Status.Font = Enum.Font.GothamBold
    UI_Status.TextScaled = true
    UI_Status.Text = "Starting..."
end
createUI()

local function setStatus(msg)
    if UI_Status then UI_Status.Text = msg end
    print("[SYSTEM]: " .. msg)
end

-- // CORE UTILITIES // --
local function safeWebhook(url, data)
    if url == "" or url:find("URL_WEBHOOK") then return end
    task.spawn(function()
        local request = (syn and syn.request) or (http and http.request) or http_request or request
        if request then
            pcall(function()
                request({
                    Url = url,
                    Method = "POST",
                    Headers = {["Content-Type"] = "application/json"},
                    Body = HttpService:JSONEncode(data)
                })
            end)
        end
    end)
end

local function getToolInfo(tool)
    return {
        Name = tool:GetAttribute("BrainrotName") or tool.Name,
        Level = tostring(tool:GetAttribute("Level") or 0),
        Mutation = tostring(tool:GetAttribute("Mutation") or "None")
    }
end

local function unequipAll()
    if player.Character then
        local hum = player.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum:UnequipTools() end
    end
end

-- // INVENTORY LOGIC // --
local function countTargets()
    local count = 0
    unequipAll()
    for _, v in pairs(player.Backpack:GetChildren()) do
        local n = v:GetAttribute("BrainrotName") or v.Name
        if n:find("Bulbito") or n:find("Burgerini") or n:find("Traktorito") then
            count = count + 1
        end
    end
    return count
end

local function findItem(itemType)
    unequipAll()
    task.wait(0.3)
    local items = player.Backpack:GetChildren()
    
    if itemType == "TARGET" then
        for _, v in pairs(items) do
            local info = getToolInfo(v)
            if string.find(info.Name, "Bulbito") or string.find(info.Name, "Traktorito") then return v end
        end
        for _, v in pairs(items) do
            local info = getToolInfo(v)
            if string.find(info.Name, "Burgerini") then return v end
        end
    elseif itemType == "COMMON" then
        for _, v in pairs(items) do
            local info = getToolInfo(v)
            for _, key in pairs(commonNames) do
                if string.find(info.Name, key) and (tonumber(info.Level) >= 150 or tonumber(info.Level) == 0) then return v end
            end
        end
    end
    return nil
end

-- // WEBHOOK PAYLOADS // --
local function sendDupeWebhook(beforeC, afterC, tool)
    local info = getToolInfo(tool)
    local payload = {
        content = "ðŸš€ **DUPE SUCCESS!**",
        embeds = {{
            title = "Auto Dupe Detection",
            color = 65280,
            fields = {
                {name="User", value="||"..player.Name.."||", inline=false},
                {name="Item", value=info.Name.." (Lvl "..info.Level..")", inline=false},
                {name="Mutation", value=info.Mutation, inline=true},
                {name="Inventory Sebelum", value=tostring(beforeC), inline=true},
                {name="Inventory Sesudah", value=tostring(afterC), inline=true},
                {name="Keuntungan", value="+"..tostring(afterC-beforeC), inline=true},
            },
            footer = {text="Dupe Monitor â€¢ "..os.date("%X")}
        }}
    }
    safeWebhook(webhook_dupe, payload)
end

local function sendInventoryReport(count)
    local payload = {
        content = "ðŸ“Š **PERIODIC INVENTORY CHECK**",
        embeds = {{
            title = "Inventory Status (Every 10 Minutes)",
            description = "Terdeteksi target Brainrot.",
            color = 16776960,
            fields = {
                {name="Target", value="Bulbito / Burgerini", inline=true},
                {name="Jumlah", value=tostring(count), inline=true},
                {name="User", value=player.Name, inline=false},
            },
            footer = {text="Inventory Monitor â€¢ "..os.date("%X")}
        }}
    }
    safeWebhook(webhook_inventory, payload)
end

-- // MAIN LOOPS // --
UIS.InputBegan:Connect(function(input, gp)
    if not gp and input.KeyCode == Enum.KeyCode.P then
        skipWait = true
        setStatus("SKIPPING WAIT...")
    end
end)

task.spawn(function()
    while true do
        task.wait(600)
        local total = countTargets()
        if total >= 1 then sendInventoryReport(total) end
    end
end)

task.spawn(function()
    while true do
        if not getgenv().AutoRadioactive then 
            setStatus("PAUSED")
            task.wait(1)
            continue 
        end

        local timer = waitTime
        skipWait = false
        while timer > 0 and not skipWait do
            setStatus("Next Dupe: " .. math.floor(timer/60) .. "m " .. (timer%60) .. "s")
            task.wait(1)
            timer = timer - 1
            if not getgenv().AutoRadioactive then break end
        end

        local char = player.Character
        local root = char and char:FindFirstChild("HumanoidRootPart")
        local hum = char and char:FindFirstChildOfClass("Humanoid")

        if root and hum then
            root.CFrame = CFrame.new(targetPosSpawn)
            task.wait(2)
            root.Anchored = true
            
            setStatus("Withdrawing...")
            spawnRemote:InvokeServer("Withdraw", machinePath)
            task.wait(2)

            local beforeCount = countTargets()
            local targetItem = findItem("TARGET")
            local commonItem = findItem("COMMON")

            if targetItem and commonItem then
                setStatus("Depositing: " .. getToolInfo(targetItem).Name)
                
                hum:EquipTool(targetItem)
                task.wait(2)
                spawnRemote:InvokeServer("Deposit", machinePath)
                
                unequipAll()
                task.wait(2)
                hum:EquipTool(commonItem)
                task.wait(2)
                spawnRemote:InvokeServer("Deposit", machinePath)
                
                task.wait(2)
                setStatus("Combining...")
                spawnRemote:InvokeServer("Combine", machinePath)
                task.wait(5)

                local afterCount = countTargets()
                if afterCount > beforeCount then
                    setStatus("âœ¨ SUCCESS! âœ¨")
                    sendDupeWebhook(beforeCount, afterCount, targetItem)
                else
                    setStatus("Fail: No Gain")
                end
            else
                setStatus("Missing Items!")
            end
            
            root.Anchored = false
            task.wait(2)
        end
    end
end)
